/* 216554588 Navarro Rizo Bruno Octavio
   219750507 Hernandez Nieto Fernando
   212554346 Duron Gonz√°lez Jonathan
   Estructuras de Datos II  D12
   Lara Lopez Graciela */

#include <iostream>
#include <fstream>

using namespace std;

int main() {

    /**Definicion de la struct del producto, usaremos este objeto para
    guardar la informacion del inventario*/
    struct Prod {
        string codigo;
        string nombre;
        string fabricante;
        string cantidad;
        string dia;
        string mes;
        string via;
        string dir;
        };


    ///Creamos y abrimos nuestro archivo de lectura
    ifstream archivo;
    archivo.open("Inventario1.txt",ios::in);


    /**Creamos un arreglo de 51 productos, ya que no
    utilizaremos el indice 0. En este arreglo almacenaremos
    nuestros productos*/
    Prod arr[51];

    /**Creamos una instancia Prod, que nos ayudara
    para guardar cada linea*/
    Prod miProd;

    /**Ind nos dira cual es el indice del arreglo donde
    guardaremos el producto.
    aux solo es un auxiliar*/
    int ind, aux;

    ///Llenamos el arreglo de espacios
    for(int i = 1; i < 51; i++)
        arr[i].nombre = " ";

    /**Leemos cada linea del inventario y lo guardamos en cada
    campo de miProd, gracias al separador de campo (','), hacemos
    esto hasta que se encuentre un salto de linea, lo cual indica que
    se salta al siguiente registro.
    Tambien, agregamos la coma al final de cada campo, para poder
    reutilizarla como separador*/
    while(!archivo.eof()) {
        getline(archivo,miProd.codigo, ',');
        miProd.codigo += ',';
        getline(archivo,miProd.nombre, ',');
        miProd.nombre += ',';
        getline(archivo,miProd.fabricante, ',');
        miProd.fabricante += ',';
        getline(archivo,miProd.cantidad, ',');
        miProd.cantidad += ',';
        getline(archivo,miProd.dia, ',');
        miProd.dia += ',';
        getline(archivo,miProd.mes, ',');
        miProd.mes += ',';
        getline(archivo,miProd.via, ',');
        miProd.via += ',';
        getline(archivo,miProd.dir, '\n');

        ///Convertimos a entero el campo liga
        ind = stoi(miProd.dir);
        ///Guardamos la direccion en el auxiliar
        aux = ind;

        /**Si el arreglo esta ocupado en el indice que queremos ingresar un nuevo
        dato, el indice incrementa hasta encontrar un lugar vacio, esta comparacion
        la realizamos buscando el espacio en blanco con el que llenamos el arreglo*/
        while(arr[ind].nombre != " ") {
            ind++;

            ///Si el indice se sobrepasa de 50, regresa al 1
            if(ind > 50)
                ind = 1;
            }

        ///Cambiamos el campo liga del producto a insertar, para que apunte a nulo
        miProd.dir = "-1";

        /**Cambiamos el campo liga del elemento que ocupa el espacio, para que apunte al
        nuevo elemento*/
        arr[aux].dir = to_string(ind);

        ///Guardamos el producto en el lugar que le corresponde
        arr[ind] = miProd;
        }

    ///Cerramos el archivo
    archivo.close();

    ///Ciclos para la impresion de datos (provisional)
    for(int i = 1; i < 51; i++)
        if(i < 10) {
            cout << "0" << i << " " << arr[i].codigo << arr[i].nombre << arr[i].fabricante
                 << arr[i].cantidad << arr[i].dia << arr[i].mes << arr[i].via << arr[i].dir << endl;
            }
        else {
            cout << i << " " << arr[i].codigo << arr[i].nombre << arr[i].fabricante
                 << arr[i].cantidad << arr[i].dia << arr[i].mes << arr[i].via << arr[i].dir << endl;
            }
    }
